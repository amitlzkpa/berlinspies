<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title>NYC Land Use</title>
  <meta name=viewport content=initial-scale=1,maximum-scale=1,user-scalable=no />
  <script src=https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.js></script>
  <link href=https://api.tiles.mapbox.com/mapbox-gl-js/v0.49.0/mapbox-gl.css rel=stylesheet />
  <style>
    body {
      margin:0;
      padding:0;
      font-family: sans-serif;
      font-size: 14px;
  }
    #map { position:absolute; top:0; bottom:0; width:100%; }
    li {
      padding: 3px 0;
    }
    #panel {
      background: white;
      width: 400px;
      border: 1px solid rgba(0, 0, 0, 0.05);
      position: absolute;
      right: 16px;
      top: 16px;
      box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.1);
      color: rgba(0, 0, 0, 0.5);
    }
    h4 {
      text-transform: uppercase;
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      margin: 0;
      padding: 16px;
    }
    ul {
      list-style-type: none;
      margin: 0;
      padding: 16px;
    }
    ul span {
      width: 10px;
      height: 10px;
      display: inline-block;
      margin-right: 8px;
      border-radius: 50%;
    }
    dd {
      margin-left: 0;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .mapboxgl-popup-content {
      font-size: 14px;
      color: rgba(0, 0, 0, 0.5);
      min-width: 250px;
      max-width: 400px;
      box-shadow: 0 0 4px 0 rgba(0, 0, 0, 0.1);
    }
    dl {
      margin-bottom: 0;
    }
  </style>
</head>
<body>

<div id=map></div>
<div id="panel">
  <h4>Land Use</h4>
  <ul>
    <li><span style="background: #F9EDDB;"></span>One & Two Family Buildings</li>
    <li><span style="background: #F6D9CB;"></span>Multi-Family Buildings</li>
    <li><span style="background: #F1B89C;"></span>Mixed Residential & Commercial Buildings</li>
    <li><span style="background: #DF7649;"></span>Commercial & Office Buildings</li>
    <li><span style="background: #CF4F4F;"></span>Industrial & Manufacturing</li>
    <li><span style="background: #BEC6CC;"></span>Transportation & Utility</li>
    <li><span style="background: #BDE7F4;"></span>Public Facilities & Institutions</li>
    <li><span style="background: #A3D393;"></span>Open Space & Outdoor Recreation</li>
    <li><span style="background: #8DA2B4;"></span>Parking Facilities</li>
    <li><span style="background: #E4E4E4;"></span>Vacant Land</li>
    <li><span style="background: #F9F9F9; border: 1px solid #ccc; box-sizing: border-box;"></span>No Data</li>
  </ul>
</div>
<script>

  let landUseNames = {
    '01': 'One & Two Family Buildings',
    '02': 'Multi-Family Walk-Up Buildings',
    '03': 'Multi-Family Elevator Buildings',
    '04': 'Mixed Residential & Commercial Buildings',
    '05': 'Commercial & Office Buildings',
    '06': 'Industrial & Manufacturing',
    '07': 'Transportation & Utility',
    '08': 'Public Facilities & Institutions',
    '09': 'Open Space & Outdoor Recreation',
    '10': 'Parking Facilities',
    '11': 'Vacant Land'
  };

  mapboxgl.accessToken = 'pk.eyJ1IjoiYW1pdGx6a3BhIiwiYSI6ImNpZmN6ZW12ZzRvYTFzeG03ZDdkNzd5d2oifQ.FxgL_waU-ZRhhtQdeOvtcA';
  const map = new mapboxgl.Map({
    container: 'map',
    style: 'mapbox://styles/amitlzkpa/cjp76fohb2iv62snufy0maxzp',
    center: [-73.990, 40.718],
    zoom: 13,
    minZoom: 13,
    maxZoom: 18,
    hash: true
  });


  map.on('click', function(event) {

    let geometry = event.point;
    let parameters = {
      layers: ['lots']
    }

    let features = map.queryRenderedFeatures(geometry, parameters);

    if(features.length > 0) {
      let lot = features[0];

      let ownerName = lot.properties.OwnerName || '—';
      let lotNo = lot.properties.Lot || '—';
      let block = lot.properties.Block || '—';
      let numFloors = lot.properties.NumFloors || '—';
      let unitsTotal = lot.properties.UnitsTotal || '—';

      let zipCode = lot.properties.ZipCode || '—';
      let landUse = landUseNames[lot.properties.LandUse] || '—';
      let zoneDist = lot.properties.ZoneDist1 || '—';
      let bldgClass = lot.properties.BldgClass || '—';
      let yearBuilt = lot.properties.YearBuilt || '—';

      let schoolDist = lot.properties.SchoolDist || '—';
      let fireComp = lot.properties.FireComp || '—';
      let policePrct = lot.properties.PolicePrct || '—';
      let healthCent = lot.properties.HealthCent || '—';

      let buildFAR = lot.properties.BuildFAR || '—';
      let residFAR = lot.properties.ResidFAR || '—';
      let commFAR = lot.properties.CommFAR || '—';
      let facilFAR = lot.properties.FacilFAR || '—';




      let popUpHtml =
        `
          <dl>
              <dt>Owner</dt>
              <dd>${ownerName}</dd>
              <dt>Block</dt>
              <dd>${block}</dd>
              <dt>Lot</dt>
              <dd>${lotNo}</dd>
              <dt>Floors</dt>
              <dd>${numFloors}</dd>
              <dt>Units</dt>
              <dd>${unitsTotal}</dd>

              <dt>ZipCode</dt>
              <dd>${zipCode}</dd>
              <dt>Land Use</dt>
              <dd>${landUse}</dd>
              <dt>Zone District</dt>
              <dd>${zoneDist}</dd>
              <dt>Building Class</dt>
              <dd>${bldgClass}</dd>
              <dt>Year Built</dt>
              <dd>${yearBuilt}</dd>

              <dt>School Dist</dt>
              <dd>${schoolDist}</dd>
              <dt>Fire Comp</dt>
              <dd>${fireComp}</dd>
              <dt>Police Prct</dt>
              <dd>${policePrct}</dd>
              <dt>Health Centre</dt>
              <dd>${healthCent}</dd>

              <dt>Build FAR</dt>
              <dd>${buildFAR}</dd>
              <dt>Resid FAR</dt>
              <dd>${residFAR}</dd>
              <dt>Comm FAR</dt>
              <dd>${commFAR}</dd>
              <dt>Facil FAR</dt>
              <dd>${facilFAR}</dd>
            </dl>
        `;

      let popup = new mapboxgl.Popup()
        .setLngLat(event.lngLat)
        .setHTML(popUpHtml)
        .addTo(map);

    }

  });



</script>





</body>
</html>